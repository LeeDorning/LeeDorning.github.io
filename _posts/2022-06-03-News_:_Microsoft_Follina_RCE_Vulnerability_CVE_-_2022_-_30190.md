---
layout: post
title: News - Microsoft 'Follina' RCE Vulnerability (CVE-2022-30190)
date: 2022-06-03
---

Information on the newly released Microsoft 'Follina' remote code execution vulnerability, dubbed CVE-2022-30190.

&nbsp;

---

&nbsp;

Right then, we’ve just had the first major vulnerability with widespread impact released since the creation of this blog, so let’s dig into the vulnerability itself, how to protect against it, and why it’s giving IT and Security teams headaches…Oh and throw in some memes too, obviously. 

&nbsp;
&nbsp;

## CVE-2022-30190 - ‘Follina’ Exploit

On Monday 30th May, Microsoft announced that a Remote Code Execution (RCE) vulnerability had been discovered in the Microsoft Support Diagnostic Tool (MSDT) in [this article](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-30190), designated as [CVE-2022-30190](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-30190) and given the nickname ‘Follina’. This vulnerability exists when an office application, such as Word, uses the URL protocol to call MSDT. This vulnerability has already been seen in the wild being exploited by threat actors and allows the attacker to run arbitrary code with the same privileges as the office application which is calling MSDT, providing an avenue for the attacker to ‘Install programs, view, change, or delete data, or create new accounts’. Yikes… Not something you want being exploited on your system then. 

The discovery of this vulnerability looks to have started out with a cyber researcher, known as [nao_sec](https://twitter.com/nao_sec), sharing a file they found on Virus Total that was using this exact method to run PowerShell commands remotely. Inspection by the cyber community confirmed that this was in fact an exploit for a Zero-Day in Microsoft Office, and it was quickly reproduced by a significant number of people, with one particular recreation worth noting being that of [Huntress Labs](https://www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug), who managed to create a Zero-Click variance of this exploit (Not good news at all). I would highly recommend giving their article a read to fully understand how this exploit works, since they go through every step in significant detail beyond that of this blog post, but in short the exploit does the following:

&nbsp;

Inside the exploit Word document, there is another file named document.xml.rels, which contains a reference to an online HTML document

![HTML Document Reference](https://github.com/LeeDorning/LeeDorning.github.io/blob/main/images/News_:_Microsoft_Follina_RCE_Vulnerability_CVE_-_2022_-_30190/TargetHtml.png?raw=true){:style="display:block; margin-left:auto; margin-right:auto"}{: width="500"}

*https://www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug*
{: style="text-align: center; font-size:75%"}

&nbsp;

This HTML document contains a large amount of commented out ‘A’ characters, which at first glance appears unnecessary but actually seems to be required for the exploit to run. At the end of this HTML document the MSDT tool is called with the parameter ***IT_BrowseForFile*** and includes some Base64 encoded PowerShell commands. When decoded these commands are as follows:

![BASE64 Decoded PowerShell Commands](https://github.com/LeeDorning/LeeDorning.github.io/blob/main/images/News_:_Microsoft_Follina_RCE_Vulnerability_CVE_-_2022_-_30190/DecodedCommands.png?raw=true){:style="display:block; margin-left:auto; margin-right:auto"}{: width="500"}

*https://www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug*
{: style="text-align: center; font-size:75%"}

&nbsp;

These commands perform the following actions, all within hidden windows, to allow for initial access to the exploited system for the attacker:

- Kills msdt.exe if it is running
- Loops through a RAR file to find a Base64 string for an encoded CAB file
- Saves this Base64 encoded CAB file
- Decodes the Base64 CAB file and saves the output
- Expands the decoded CAB file into the current directory
- Executes a specificed .exe which is presumed to be stored within the CAB file
{: style="text-align: center"}

Some very smart threat hunters have managed to develop versions of this exploit which run with a single click by saving the exploit as a .rtf file and using the preview pane within windows explorer to trigger the RCE, only needing the file to be selected and previewed and not even fully opened, so it’s pretty clear why this has got IT and Security team’s scrambling; It’s a readily available, easily exploited vulnerability with a high potential impact…scary stuff!

&nbsp;
&nbsp;

## Protecting Against ‘Follina’
